import { Meta, Story, Source } from '@storybook/addon-docs/blocks';
import * as InvalidMessageStories from './InvalidMessage.stories';

<Meta of={InvalidMessageStories} />

# Form/InvalidMessage

<Source
  language='javascript'
  code={`
import { InvalidMessage } from '@openameba/spindle-ui/Form';
import '@openameba/spindle-ui/Form/InvalidMessage.css';
  `}
/>

<Source
  language='css'
  code={`@import './node_modules/@openameba/spindle-ui/Form/InvalidMessage.css'`}
/>

<Source
  language='html'
  code={`<link rel="stylesheet" href="https://unpkg.com/@openameba/spindle-ui/Form/InvalidMessage.css">`}
/>

## Invalid Message

<Story of={InvalidMessageStories.Default} />

<Source
  code={`
<InvalidMessage visible>ファイル形式が正しくありません</InvalidMessage>
  `}
/>

<Source
  language='html'
  code={`
<p class="spui-InvalidMessage">
  <span class="spui-InvalidMessage-icon"><svg>...</svg></span>
  <span class="spui-InvalidMessage-body">ファイル形式が正しくありません</span>
</p>
  `}
/>

## Hidden

<Story of={InvalidMessageStories.Hidden} />

<Source
  code={`
<InvalidMessage visible={false}>ファイル形式が正しくありません</InvalidMessage>
  `}
/>

## Long Text

<Story of={InvalidMessageStories.LongText} />

<Source
  code={`
<InvalidMessage visible>
  このフィールドは必須項目です。また、入力された値が正しい形式であることを確認してください。具体的には、半角英数字とハイフンのみが使用可能です。さらに、文字数は10文字以上100文字以下である必要があります。これらの条件を満たさない場合、エラーメッセージが表示されます。画面幅が狭い場合や、テキストサイズを200%に拡大した場合でも、このテキストは適切に折り返されて表示されることを確認するためのストーリーです。
</InvalidMessage>
  `}
/>

## With Role Alert

TextFieldとの紐付けと`role="alert"`を含むインタラクティブなStoryです。

<Story of={InvalidMessageStories.WithRoleAlert} />

<Source
  code={`
const [hasError, setHasError] = useState(false);

<TextField
  id="test-input"
  hasError={hasError}
  aria-invalid={hasError}
  aria-errormessage={hasError ? 'test-error' : undefined}
  variant="medium"
/>
<InvalidMessage
  id="test-error"
  visible={hasError}
  role="alert"
>
  内容を入力してください
</InvalidMessage>
<Button onClick={() => setHasError(!hasError)} size="medium">
  {hasError ? 'エラーを解除' : 'エラーを表示'}
</Button>
  `}
/>

## Accessibility

### 入力欄との関連付け

入力欄に`aria-invalid="true"`を設定してエラー状態を示し、`aria-errormessage`属性でエラーメッセージのIDを参照することで、入力欄とエラーメッセージを関連付けます。対象ユーザーの環境に合わせて保守的にしたい場合は、`aria-describedby`でも問題ありません。

<Source
  code={`
<TextField
  id="username"
  hasError={hasError}
  aria-invalid={hasError}
  aria-errormessage="username-error"
/>
<InvalidMessage id="username-error" visible={hasError}>
  ユーザー名は3文字以上で入力してください
</InvalidMessage>
  `}
/>

### スクリーンリーダーへの通知

コンポーネントからはアプリケーション内での使われ方や重要度がわからないため、アラートに関する属性は付与していません。エラーメッセージが表示された際、スクリーンリーダーへ通知する方法は利用状況によって異なります。例えば以下のような選択肢があります。

- `role="alert"`を指定する（即座に通知される）
- `aria-live="polite"`を指定する（読み上げが中断されないタイミングで通知される）
- 通知用の要素を作成し、そこに`role="alert"`を指定してエラーメッセージの内容を動的に更新する

アプリケーションの要件に応じて、エラーメッセージの表示タイミングを工夫し適切な方法を選択してください。
